import{c as U}from"./cart-bJv941xm.js";import{_ as E,R as L,m as R,c as l,b as t,n as h,d as u,w as N,e as c,t as i,F as b,r as C,o as n,i as k,g as m,z as x,A as w,D as P}from"./index-YU522o6f.js";import{M as I}from"./bootstrap.esm-l9cKv-78.js";import{S as M}from"./sweetalert2.all-eK8a_lGc.js";import{a as p}from"./axios-G2rPRu76.js";import"./_commonjsHelpers-1J56E-h6.js";var J={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_API_NAME:"ssozr",BASE_URL:"/vue2024week62/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:y,VITE_APP_API_NAME:f}=J,j={data(){return{paymentOptions:["ATM","信用卡","電信支付"],num:1,cartData:[],dalModal:"",delData:{},delId:"",disabled:!0,addressData:"",address:{city:"",areaName:"",content:"",index:"",areaList:[]},paymentMethod:"",userData:{user:{name:"",email:"",address:"",phone:""},message:""},coupon:{couponJudge:!1,couponNum:""},orderId:"",payModal:""}},components:{RouterLink:L},methods:{nextBtn(){this.num++},preBtn(){this.num--},getCartData(){p.get(`${y}/v2/api/${f}/cart`).then(a=>{this.cartData=a.data.data}).catch(a=>{alert(a.data.message).error(a)})},openDelModal(a){this.deldata={},this.delModal.show(),this.delId=a.id,this.delData=a.product},delCart(){p.delete(`${y}/v2/api/${f}/cart/${this.delId}`).then(a=>{this.delData={},this.delId="",this.delModal.hide(),this.getCartData(),this.getCartDataPinia(),M.fire(`${a.data.message}`)}).catch(a=>{alert(a.data.message).error(a)})},changeQty(a,e){this.disabled=!0;const A={product_id:e,qty:a};p.put(`${y}/v2/api/${f}/cart/${e}`,{data:A}).then(v=>{M.fire(`${v.data.message}`),this.disabled=!1,this.getCartData()}).catch(v=>{alert(v.data.message).error(v)})},getAddressData(){p.get("https://raw.githubusercontent.com/donma/TaiwanAddressCityAreaRoadChineseEnglishJSON/master/AllData.json").then(a=>{this.addressData=a.data}).catch(a=>{alert(a.data.message).error(a)})},disabledBtn(){this.disabled=!1},city(){this.address.areaName="";const a=this.addressData.findIndex(e=>e.CityName===this.address.city);this.address.index=a,this.address.areaList={...this.addressData[a].AreaList}},isPhone(a){return/^(09)[0-9]{8}$/.test(a)?!0:"需要正確的電話號碼"},couponBtn(){const a={code:this.coupon.couponNum};p.post(`${y}/v2/api/${f}/coupon`,{data:a}).then(e=>{this.coupon.couponJudge=e.data.success,M.fire(`${e.data.message}`)}).catch(e=>{alert(e.data.message).error(e)})},couponBtnDel(){this.coupon.couponJudge=!1},onSubmit(){this.userData.user.address=`${this.address.city}${this.address.areaName}${this.address.content}`;const a={user:{name:this.userData.user.name,email:this.userData.user.email,tel:this.userData.user.phone,address:this.userData.user.address},message:this.userData.message};p.post(`${y}/v2/api/${f}/order`,{data:a}).then(e=>{this.orderId=e.data.orderId,this.payModal.show()}).catch(e=>{alert(e.data.message).error(e)})},pay(){p.post(`${y}/v2/api/${f}/pay/${this.orderId}`).then(a=>{this.payModal.hide(),M.fire(`${a.data.message}`),this.getCartDataPinia(),this.num++}).catch(a=>{alert(a.data.message).error(a)})},formatNumber(a){if(a)return a.toLocaleString()},...R(U,["getCartDataPinia"])},mounted(){this.getCartData(),this.delModal=new I(this.$refs.delModal),this.getAddressData(),this.payModal=new I(this.$refs.payModal)}},q={class:"container-fluid mt-30","data-aos":"fade-right"},O={class:"container mb-15"},z={class:"row"},F={class:"d-md-flex justify-content-center"},Q={class:"order-progress pt-4 col-md-6"},W=t("li",{class:"active"},"訂單確認",-1),G={class:"row"},H={key:0,class:"row"},K=t("h2",{class:"text-center"},"訂單確認",-1),X={class:"row justify-content-center"},Y={class:"col-6"},Z={class:"table align-middle d-lg-table d-none col-12"},$=t("thead",null,[t("tr",{class:"text-center"},[t("th",{scope:"col"},"課程名稱"),t("th",{scope:"col"},"授課老師"),t("th",{scope:"col"},"總課程數"),t("th",{scope:"col"},"購買數量"),t("th",{scope:"col"},"價格"),t("th")])],-1),tt={class:"fs-6 mb-0"},et={class:"dropdown"},st={class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},ot={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},at=["onClick"],lt=["onClick"],nt={class:"text-center"},dt=t("td",null,null,-1),it=t("td",null,null,-1),rt=t("td",null,null,-1),ct=t("td",null,null,-1),ut=t("td",null,null,-1),mt={class:"align-bottom"},_t={class:"border-bottom border-primary border-3 mb-0 fs-6"},ht={class:"ms-1"},pt={class:"row d-lg-none my-15 justify-content-center"},bt={class:"col-md-8"},yt={class:"d-flex justify-content-between align-items-center mb-3"},ft={class:"fs-6"},vt={class:"d-flex align-items-center justify-content-between"},gt={class:"text-end"},Dt={class:"mb-0 fs-6"},kt={class:"ms-1"},xt={key:1,class:"row col-md-6 offset-md-3"},Nt={class:"mb-3 col-md-6"},Ct={for:"name",class:"form-label"},Mt={key:0,class:"text-danger"},Vt={class:"mb-3 col-md-6"},wt={for:"email",class:"form-label"},At={key:0,class:"text-danger"},Bt={class:"mb-3 col-md-6"},Pt={for:"phone",class:"form-label"},It={key:0,class:"text-danger"},Tt={class:"mb-3 col-md-6"},St={for:"payment",class:"form-label"},Ut={key:0,class:"text-danger"},Et=t("option",{value:"信用卡"},"信用卡",-1),Lt=t("option",{value:"ATM"},"ATM",-1),Rt=t("option",{value:"電信繳費"},"電信繳費",-1),Jt=[Et,Lt,Rt],jt={class:"input-group mb-3"},qt={style:{width:"100%"},for:"地址",class:"form-label"},Ot={key:0,class:"text-danger"},zt={key:0,value:""},Ft=["value"],Qt=["disabled"],Wt={key:0,value:""},Gt=["value"],Ht={class:"input-group mb-3"},Kt=t("span",{class:"input-group-text"},"留言區",-1),Xt={class:"col-md-8"},Yt=t("label",{for:"coupon",class:"mb-3"},"優惠券:",-1),Zt={class:"input-group"},$t=["disabled"],te=["disabled"],ee={key:0},se={key:1},oe={class:"text-end d-flex justify-content-center col-md-4 mt-3"},ae={class:"d-flex align-items-end"},le={key:0,class:"border-bottom border-primary border-3 mb-0 fs-5"},ne={class:"ms-1"},de={key:1,class:"border-bottom border-primary border-3 mb-0 fs-5"},ie={class:"ms-1"},re={class:"text-center mt-6 btn-list"},ce=["disabled"],ue={key:0,class:"row"},me={class:"d-flex justify-content-center"},_e={class:"text-center"},he={class:"text-center"},pe={type:"button",class:"btn btn-primary fs-3"},be=t("li",null,"付款完成",-1),ye=t("li",null,"客服人員將會在三天內與您電話連絡",-1),fe=t("li",null,"若有任何問題，皆可連絡客服",-1),ve={class:"modal",tabindex:"-1",id:"payModal",ref:"payModal"},ge={class:"modal-dialog"},De={class:"modal-content"},ke={class:"modal-header"},xe={class:"modal-title"},Ne=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ce=t("div",{class:"modal-body"},[t("h3",null,"資料傳送完成，繼續付款？")],-1),Me={class:"modal-footer"},Ve=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),we={class:"modal",tabindex:"-1",ref:"delModal"},Ae={class:"modal-dialog"},Be={class:"modal-content"},Pe={class:"modal-header"},Ie={key:0,class:"modal-title"},Te=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Se=t("div",{class:"modal-body"},[t("p",null,"確定移出購物車?")],-1),Ue={class:"modal-footer"},Ee=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Le(a,e,A,v,s,d){const B=C("RouterLink"),g=C("v-field"),D=C("error-message"),T=C("v-form");return n(),l(b,null,[t("div",q,[t("div",O,[t("div",z,[t("div",F,[t("ul",Q,[W,t("li",{class:h({active:s.num>=2})},"填寫資料",2),t("li",{class:h({active:s.num>=3})},"付款完成",2)])])]),t("div",G,[u(T,{onSubmit:e[17]||(e[17]=r=>d.onSubmit())},{default:N(({errors:r})=>[s.num===1?(n(),l("div",H,[K,t("div",X,[t("div",Y,[t("table",Z,[$,t("tbody",null,[(n(!0),l(b,null,k(s.cartData.carts,(o,_)=>(n(),l("tr",{key:_,class:"text-center"},[t("td",null,[t("h2",tt,i(o.product.title),1)]),t("td",null,i(o.product.unit),1),t("td",null,i(o.product.origin_price*o.qty)+"堂",1),t("td",null,[t("div",et,[t("button",st,i(o.qty),1),t("ul",ot,[(n(),l(b,null,k(20,(V,S)=>t("li",{key:S},[t("a",{onClick:Re=>d.changeQty(V,o.id),class:"dropdown-item"},i(V),9,at)])),64))])])]),t("td",null,i(d.formatNumber(o.total)),1),t("td",null,[t("button",{type:"button",class:"btn btn-primary rounded-pill",onClick:V=>d.openDelModal(o)}," 刪除 ",8,lt)])]))),128)),t("tr",nt,[dt,it,rt,ct,ut,t("td",mt,[t("h2",_t,[m(" 總金額:NT "),t("span",ht,i(d.formatNumber(s.cartData.total)),1)]),s.num===1?(n(),l("button",{key:0,class:"btn btn-primary rounded-pill mt-3",type:"button",onClick:e[0]||(e[0]=(...o)=>d.nextBtn&&d.nextBtn(...o))}," 下一步 ")):c("",!0)])])])])]),t("div",pt,[t("div",bt,[(n(!0),l(b,null,k(s.cartData.carts,(o,_)=>(n(),l("ul",{key:_,class:"border-bottom pb-3 border-primary"},[t("li",null,[t("div",yt,[u(B,{to:`/class/${o.product.id}`},{default:N(()=>[t("h2",ft,i(o.product.title),1)]),_:2},1032,["to"])]),t("div",vt,[t("div",null," 堂數:"+i(o.product.origin_price*o.qty),1),t("div",null,"此課程共:NT$"+i(d.formatNumber(o.total)),1)])])]))),128)),t("div",gt,[t("h2",Dt,[m(" 總金額:NT "),t("span",kt,i(d.formatNumber(s.cartData.total)),1)]),s.num===1?(n(),l("button",{key:0,class:"btn btn-primary rounded-pill mt-3",type:"button",onClick:e[1]||(e[1]=(...o)=>d.nextBtn&&d.nextBtn(...o))}," 下一步 ")):c("",!0)])])])])])):c("",!0),s.num===2?(n(),l("div",xt,[t("div",Nt,[t("label",Ct,[m("*姓名: "),r.姓名?(n(),l("span",Mt,i(r.姓名),1)):c("",!0)]),u(g,{id:"name",name:"姓名",type:"text",class:h(["form-control",{"is-invalid":r.姓名}]),placeholder:"請輸入 姓名",rules:"required",modelValue:s.userData.user.name,"onUpdate:modelValue":e[2]||(e[2]=o=>s.userData.user.name=o),onClick:e[3]||(e[3]=o=>d.disabledBtn())},null,8,["class","modelValue"]),u(D,{name:"姓名",class:"invalid-feedback"})]),t("div",Vt,[t("label",wt,[m("*信箱: "),r.email?(n(),l("span",At,i(r.email),1)):c("",!0)]),u(g,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":r.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.userData.user.email,"onUpdate:modelValue":e[4]||(e[4]=o=>s.userData.user.email=o)},null,8,["class","modelValue"]),u(D,{name:"email",class:"invalid-feedback"})]),t("div",Bt,[t("label",Pt,[m("*手機號碼: "),r.電話?(n(),l("span",It,i(r.電話),1)):c("",!0)]),u(g,{id:"phone",name:"電話",type:"tel",class:h(["form-control",{"is-invalid":r.電話}]),placeholder:"0912345678",rules:d.isPhone,modelValue:s.userData.user.phone,"onUpdate:modelValue":e[5]||(e[5]=o=>s.userData.user.phone=o)},null,8,["class","rules","modelValue"]),u(D,{name:"電話",class:"invalid-feedback"})]),t("div",Tt,[t("label",St,[m("*付款方式: "),r.付款方式?(n(),l("span",Ut,i(r.付款方式),1)):c("",!0)]),u(g,{id:"phone",name:"付款方式",type:"select",class:h(["form-control",{"is-invalid":r.付款方式}]),placeholder:"請選擇",rules:"required",modelValue:s.paymentMethod,"onUpdate:modelValue":e[7]||(e[7]=o=>s.paymentMethod=o)},{default:N(()=>[x(t("select",{class:"form-select",id:"payment","onUpdate:modelValue":e[6]||(e[6]=o=>s.paymentMethod=o)},Jt,512),[[w,s.paymentMethod]])]),_:2},1032,["class","modelValue"]),u(D,{name:"付款方式",class:"invalid-feedback"})]),t("div",jt,[t("label",qt,[m("*地址: "),r.地址?(n(),l("span",Ot,i(r.地址),1)):c("",!0)]),x(t("select",{class:"btn btn-secondary",onChange:e[8]||(e[8]=(...o)=>d.city&&d.city(...o)),"onUpdate:modelValue":e[9]||(e[9]=o=>s.address.city=o)},[s.address.city?c("",!0):(n(),l("option",zt,"請選擇")),(n(!0),l(b,null,k(s.addressData,(o,_)=>(n(),l("option",{value:o.CityName,key:_},i(o.CityName),9,Ft))),128))],544),[[w,s.address.city]]),x(t("select",{class:"btn btn-secondary",disabled:!s.address.city,"onUpdate:modelValue":e[10]||(e[10]=o=>s.address.areaName=o)},[s.address.areaName?c("",!0):(n(),l("option",Wt,"請選擇")),(n(!0),l(b,null,k(s.address.areaList,(o,_)=>(n(),l("option",{value:o.AreaName,key:_},i(o.AreaName),9,Gt))),128))],8,Qt),[[w,s.address.areaName]]),u(g,{id:"地址",name:"地址",type:"text",class:h(["form-control",{"is-invalid":r.地址}]),placeholder:"請輸入詳細地址",rules:"required",modelValue:s.address.content,"onUpdate:modelValue":e[11]||(e[11]=o=>s.address.content=o),disabled:!s.address.areaName},null,8,["class","modelValue","disabled"]),u(D,{name:"地址",class:"invalid-feedback"})]),t("div",Ht,[Kt,x(t("textarea",{class:"form-control","aria-label":"With textarea",placeholder:"可以說說自己，或有其他想告訴我們的也很歡迎","onUpdate:modelValue":e[12]||(e[12]=o=>s.userData.message=o)},null,512),[[P,s.userData.message]])]),t("div",Xt,[Yt,t("div",Zt,[x(t("input",{id:"coupon",type:"text",class:"form-control",placeholder:"輸入優惠券","onUpdate:modelValue":e[13]||(e[13]=o=>s.coupon.couponNum=o),disabled:s.coupon.couponJudge},null,8,$t),[[P,s.coupon.couponNum]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[14]||(e[14]=o=>d.couponBtn()),disabled:s.coupon.couponJudge},[s.coupon.couponJudge?(n(),l("span",ee,"已套用")):(n(),l("span",se,"套用"))],8,te),s.coupon.couponJudge?(n(),l("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:e[15]||(e[15]=o=>d.couponBtnDel())}," 重設優惠券 ")):c("",!0)])]),t("div",oe,[t("div",ae,[s.coupon.couponJudge?(n(),l("h2",de,[m(" 總金額:NT "),t("span",ie,i(d.formatNumber(s.cartData.final_total)),1)])):(n(),l("h2",le,[m(" 總金額:NT "),t("span",ne,i(d.formatNumber(s.cartData.total)),1)]))])])])):c("",!0),t("div",re,[s.num===2?(n(),l("button",{key:0,class:"btn btn-secondary rounded-pill me-3",type:"button",onClick:e[16]||(e[16]=(...o)=>d.preBtn&&d.preBtn(...o))}," 上一步 ")):c("",!0),s.num===2?(n(),l("button",{key:1,class:"btn btn-primary rounded-pill me-3 test",type:"submit",disabled:r.付款方式||s.disabled}," 送出訂單 ",8,ce)):c("",!0)])]),_:1}),s.num===3?(n(),l("div",ue,[t("div",me,[t("ul",_e,[t("li",null,[t("h2",he,[t("button",pe,[u(B,{to:"/"},{default:N(()=>[m("繼續購物")]),_:1})])])]),be,ye,fe])])])):c("",!0)])])]),t("div",ve,[t("div",ge,[t("div",De,[t("div",ke,[t("h5",xe,"金額為: "+i(s.cartData.final_total),1),Ne]),Ce,t("div",Me,[Ve,t("button",{type:"button",class:"btn btn-primary",onClick:e[18]||(e[18]=r=>d.pay())}," 立即支付 ")])])])],512),t("div",we,[t("div",Ae,[t("div",Be,[t("div",Pe,[s.delData.title?(n(),l("h5",Ie,i(s.delData.title),1)):c("",!0),Te]),Se,t("div",Ue,[Ee,t("button",{type:"button",class:"btn btn-primary",onClick:e[19]||(e[19]=r=>d.delCart(s.delData.id))}," 確認移出 ")])])])],512)],64)}const Qe=E(j,[["render",Le]]);export{Qe as default};
